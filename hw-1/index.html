<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Intro to javscript</title>
		<meta charset="utf-8">
		<script type="text/javascript" src="app.js"></script>
		<script type="text/javascript" src="mesh_small.json"></script>
		<script id="vert-shader" type="x-shader/x-vertex">#version 300 es
			precision mediump float;

			layout(location = 0) in vec3 a_pos;
			layout(location = 1) in vec3 a_normal;

			uniform mat4 u_model;
			uniform mat4 u_vp;
			uniform vec3 u_sunlight;

			uniform vec3 u_ripple_origin;
			uniform float u_ripple_time;
			uniform vec3 u_indices;
			uniform vec3 u_color;


			out vec3 pos;
			out vec3 normal;

			out vec4 world_pos;
			out float shading;
			out float spec;

			out vec4 vertex_color;

			#define TAU 6.28318

			void main(void) {
				pos = a_pos;
				normal = a_normal;

				// lighting

				vec3 adjusted_normal = (u_model * vec4(normal, 1.0)).xyz;

				vec3 normalized_normal = normalize(adjusted_normal);
				vec3 normalized_sunlight = normalize(u_sunlight);

				float product = dot(normalized_normal, normalized_sunlight);
				float diffuse = 0.5 + 0.6 * product;

				float ambient = 0.3;

				shading = max(ambient, diffuse);
				spec = pow(max(product, 0.0), 32.0);

				// ripple

				vec3 normalized_ripple = normalize(u_ripple_origin);
				float phase = dot(normalized_normal, normalized_ripple) * 3.0;

				float theta = u_ripple_time * 6.0 + phase - TAU / 2.0;
				float disp = theta < TAU / 2.0 && theta > 0.0 ? sin(theta) : 0.0;

				pos += normal * disp * disp * 0.15;

				// output position

				world_pos = u_model * vec4(pos, 1.0);
				if ((u_indices.x == float(gl_VertexID) || u_indices.y == float(gl_VertexID) || u_indices.z == float(gl_VertexID))
				&& u_color != vec3(0.0, 1.0, 0.0)) {
					vertex_color = vec4(1.0, 0.0, 1.0, 1.0);
				} else {
					vertex_color = vec4(u_color, 1.0);
				}

				gl_Position = u_vp * world_pos;
				gl_PointSize = 10.0;
			}
		</script>

		<script id="frag-shader" type="x-shader/x-fragment">#version 300 es
			precision mediump float;
			precision lowp int;

			uniform float u_alpha;

			in vec3 pos;
			in vec3 normal;

			in vec4 world_pos;
			in float shading;
			in float spec;

			in vec4 vertex_color;

			out vec4 frag_colour;

			void main(void) {
				vec3 diffuse_colour = vec3(1.0, 0.0, 0.0) * shading;
				vec3 spec_colour = vec3(spec);

				vec4 clamped_color = vertex_color;

				frag_colour = clamped_color;
			}
		</script>
	</head>

	<body>
		<button id="switch" onclick="toggle_parts()">Switch to part 2</button>
		<br>
		<canvas id="canvas" width="900" height="900", style="border:3px solid #020000; position:relative; top:5; left:5;"></canvas>
	</body>
</html>
